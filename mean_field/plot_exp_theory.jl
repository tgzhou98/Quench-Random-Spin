
using Plots
using LinearAlgebra
using LaTeXStrings
using Distributions
using JLD2
using LsqFit


function A_polynomial(xi::Array{Float64, 1})
    A = (-xi[1]^2+xi[2]^2-4*xi[2]*xi[3]+xi[3]^2)
    omega = 0.0
    if A > 0
        omega = sqrt(A)
    else
        omega = 0.0
    end

    return omega
end

function B_polynomial(xi::Array{Float64, 1})
    B = (xi[1]^2+xi[2]^2+xi[3]^2)
    decay = 0.0

    A = (-xi[1]^2+xi[2]^2-4*xi[2]*xi[3]+xi[3]^2)
    if A > 0
        decay = sqrt(B)
    else
        decay = -sqrt(-A) + sqrt(B)
    end

    return decay
end

m_expx = [1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0
;0.996489288	0.989520844	0.979126831	0.966342574	0.950566054	0.932793189	0.912163762	0.889051308	0.865309787	0.839829159	0.812965101	0.786898042	0.758559663
;0.992909468	0.978701861	0.954116575	0.918904811	0.871896453	0.818241351	0.755317815	0.687054942	0.616512254	0.54615711	0.479413851	0.416607429	0.360112039
;0.98959226	0.969907969	0.928988117	0.865711323	0.780220851	0.675558373	0.558924318	0.437000995	0.322769259	0.221572215	0.141898377	0.084883964	0.051288304
;0.988037319	0.963305615	0.907023314	0.81443873	0.687138819	0.53022112	0.358762729	0.192279046	0.055762444	-0.038668883	-0.085335151	-0.090556833	-0.068456404
;0.988030408	0.959227691	0.886880219	0.767397674	0.600803476	0.398294576	0.184100185	-0.00644573	-0.133131008	-0.184704958	-0.169481034	-0.116614398	-0.055183177
;0.987608846	0.953506113	0.868357194	0.725541644	0.530015457	0.294903234	0.05356123	-0.135680526	-0.226251714	-0.216313413	-0.145716551	-0.065461008	-0.006549519
;0.986641327	0.948928851	0.850974475	0.688668806	0.470367482	0.219434033	-0.026620419	-0.193497191	-0.231736773	-0.168219033	-0.075994881	-0.008802007	0.020052675
;0.985818936	0.944545776	0.833466601	0.654851305	0.424916102	0.170103524	-0.0620168	-0.191569041	-0.177909413	-0.088502285	-0.010320894	0.01971566	0.019432561
;0.985604699	0.941362498	0.818364495	0.623873388	0.387283639	0.141275724	-0.063904328	-0.150848177	-0.099747325	-0.013313949	0.025398857	0.022085163	0.010813673
;0.984533518	0.936341381	0.802038645	0.595345309	0.356147216	0.124876343	-0.047250895	-0.093532692	-0.024989037	0.034849992	0.033661135	0.012460799	0.004730982
;0.984955079	0.931888953	0.787152085	0.569260107	0.328930695	0.115812793	-0.023479181	-0.037922609	0.030543703	0.050932463	0.023277649	0.004014217	0.002828835
;0.983151348	0.927304755	0.771952636	0.544650376	0.304164984	0.108337629	-0.002270606	0.004956112	0.058101251	0.044873712	0.009576732	0.001944386	0.005274453
;0.982819627	0.922734429	0.75739287	0.521223805	0.28112598	0.100019506	0.012773901	0.030425794	0.061609461	0.027970423	0.000702433	0.001721374	0.006333524
;0.98219765	0.91882295	0.743444977	0.498569768	0.260516898	0.091952181	0.020310084	0.039969094	0.048850435	0.010002852	-0.002649771	0.003610008	0.006347459
;0.981575674	0.915181946	0.729851691	0.476785702	0.241836436	0.082310404	0.021034449	0.036043185	0.028364993	-0.002678093	-0.001488323	0.004906265	0.005978178
;0.98056669	0.9109029	0.716529575	0.457263559	0.224256054	0.072689526	0.017893212	0.026075274	0.009069837	-0.008159489	0.00158569	0.00542895	0.005992113
;0.980034554	0.907365924	0.703916674	0.43794325	0.207977664	0.064280838	0.012822656	0.014478529	-0.00483771	-0.007102164	0.003393933	0.004522963	0.005762183
;0.980269523	0.902747051	0.690114795	0.419562509	0.193105705	0.055286954	0.007313302	0.003856301	-0.012146482	-0.004618841	0.00410332	0.005254722	0.005406837
;0.97943331	0.898787026	0.677571426	0.401947342	0.179173687	0.048626883	0.003580035	-0.003438651	-0.013288042	-0.000340848	0.004833572	0.005247752	0.005594961
;0.977774706	0.895229245	0.666585547	0.385633652	0.1667595	0.042949102	0.00136515	-0.005902785	-0.01004434	0.002246816	0.00394336	0.004223291	0.005880632
;0.976869385	0.891713075	0.654800064	0.370057696	0.155591606	0.039019938	0.000285567	-0.006932988	-0.005519862	0.00355456	0.004611019	0.005191999	0.005121166
;0.976530753	0.887538057	0.643070205	0.354829729	0.145210477	0.035411239	0.000626854	-0.005130133	-0.000814406	0.004118003	0.003672124	0.0046275	0.00522568
;0.975418106	0.883210464	0.631319487	0.340353417	0.135128737	0.032304134	0.001608926	-0.003153257	0.002213514	0.003971925	0.00394336	0.00486445	0.005378966
;0.975217692	0.879728971	0.620215407	0.327324736	0.12629329	0.029322428	0.001692507	-0.000661279	0.004148598	0.003255448	0.00379731	0.005303505	0.005532253
;0.97414651	0.876025549	0.608770625	0.313488722	0.117799006	0.027148848	0.002207921	0.000890986	0.004106833	0.003220668	0.004186778	0.005568332	0.006110561
;0.973552177	0.871725697	0.598396618	0.301135138	0.110188963	0.024264675	0.003015866	0.002032563	0.004044187	0.002872864	0.003845993	0.005603178	0.005142069
;0.972501728	0.868923858	0.587125663	0.288802433	0.102648546	0.022195594	0.002472593	0.002756489	0.002979194	0.002733742	0.003595621	0.004892327	0.005413804
;0.972142364	0.864103862	0.576313612	0.277792084	0.095484105	0.020022014	0.002890495	0.002526782	0.002394493	0.00243463	0.00395727	0.004543871	0.005581026
;0.970587422	0.860934455	0.566885225	0.266559022	0.08941278	0.017709103	0.002820845	0.002269231	0.00189332	0.002469411	0.003546938	0.005080493	0.004946977
;0.969557706	0.857078458	0.556956216	0.256383845	0.08373832	0.016733778	0.00281388	0.001642756	0.001357343	0.002657225	0.003748626	0.004989895	0.005135101
;0.969854872	0.853243268	0.546651741	0.245958116	0.07800816	0.015019994	0.002618859	0.001134616	0.00170538	0.002483323	0.004082456	0.004885358	0.005183874
;0.968756047	0.849463559	0.537153823	0.236284042	0.073217941	0.013724206	0.001887528	0.001740208	0.001594008	0.002358113	0.003414797	0.005101401	0.005852761
;0.968369039	0.846058353	0.52782278	0.226470772	0.06856001	0.012163687	0.001532311	0.001092851	0.001809791	0.002643313	0.003644305	0.00487142	0.004758852
;0.967055978	0.842188486	0.51809541	0.218383525	0.063797641	0.010700701	0.001671612	0.00142001	0.001955966	0.002372025	0.003060103	0.004857481	0.005288388
;0.966814098	0.838325554	0.50904249	0.209551582	0.059668862	0.010129439	0.001483556	0.001399127	0.001726262	0.002782434	0.003665169	0.004529932	0.005574058
;0.965659986	0.834781644	0.500066054	0.201081548	0.055672371	0.009774143	0.001588031	0.001322558	0.001594008	0.002260728	0.003213108	0.004543871	0.005413804
;0.965390463	0.831189187	0.491750162	0.193182214	0.052594934	0.008972984	0.001762157	0.001531383	0.001559205	0.002337245	0.003373068	0.004941111	0.004953944
;0.964367657	0.82746496	0.483177005	0.185895339	0.048960495	0.008109125	0.001790018	0.001517461	0.00179587	0.001982485	0.003380023	0.00446721	0.005518318
;0.963185902	0.824052819	0.474443927	0.17873374	0.045632406	0.007363698	0.001824843	0.001698443	0.001691458	0.00255984	0.003178334	0.004028155	0.004884269
;0.96325501	0.820647613	0.466767718	0.171711337	0.043098046	0.006527706	0.001950214	0.001969915	0.001816752	0.002406806	0.003407842	0.004968987	0.005302323]

 
m_expy = [1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0
;0.761737607	0.790756155	0.816990441	0.844306804	0.868792315	0.892945982	0.914106429	0.935068216	0.952190816	0.96812277	0.980483669	0.990516016	0.997269137
;0.367272727	0.424521476	0.486544445	0.554115314	0.62341154	0.692508741	0.759321321	0.821627084	0.875163742	0.921284904	0.956342282	0.97984128	0.993431924
;0.057383079	0.093751976	0.151241836	0.232877672	0.33156196	0.445740752	0.563857533	0.679916905	0.782732654	0.86857215	0.930799364	0.971078751	0.990533008
;-0.066148187	-0.084999824	-0.07589073	-0.027619935	0.066696073	0.202118938	0.364846105	0.533251923	0.688641379	0.815032144	0.907561965	0.964487592	0.990343949
;-0.055246103	-0.113848207	-0.161655874	-0.173447868	-0.122007744	0.003174203	0.188676996	0.40141626	0.600658471	0.766574828	0.885298631	0.959185246	0.989867798
;-0.009185497	-0.065486601	-0.14037227	-0.206371783	-0.215365442	-0.127458606	0.056453761	0.29338611	0.52633533	0.721917261	0.866055599	0.953693781	0.989188584
;0.017516202	-0.01033962	-0.073325765	-0.160737933	-0.221596757	-0.186934617	-0.026333871	0.214235585	0.46502049	0.682622808	0.8462029	0.947915134	0.989202588
;0.017873533	0.01765181	-0.010736411	-0.082656615	-0.170682014	-0.18647215	-0.064074879	0.163262871	0.415354979	0.646293843	0.827478434	0.942738868	0.988026216
;0.009872132	0.019604538	0.023414067	-0.012079343	-0.093581746	-0.14674907	-0.068337657	0.131828645	0.374985114	0.612600865	0.809132382	0.937940841	0.988264292
;0.004196882	0.011800653	0.029658285	0.032748751	-0.020976426	-0.090117929	-0.051805371	0.114641233	0.341809394	0.582812796	0.791536149	0.932386336	0.986821836
;0.00328604	0.003989745	0.021143442	0.047399508	0.030211375	-0.034804117	-0.028381126	0.104738645	0.313481139	0.553971158	0.773981962	0.926698747	0.987508053
;0.004757401	0.001166017	0.009159588	0.040294837	0.055493709	0.00705612	-0.006800813	0.097222222	0.287660677	0.526762992	0.757359794	0.921417414	0.986828838
;0.005514101	0.001727953	0.000988142	0.024964442	0.057146058	0.03195224	0.009044381	0.090498849	0.264544149	0.501742136	0.741634607	0.916731458	0.985925552
;0.004589245	0.003378639	-0.00177305	0.008667138	0.044130311	0.040262625	0.017801304	0.081929706	0.244096529	0.477681732	0.724823232	0.91139409	0.985582444
;0.005233841	0.004530608	-0.000511591	-0.003047862	0.025079292	0.037088422	0.01979247	0.073865869	0.224951841	0.455668426	0.709826841	0.906140775	0.984973252
;0.005128744	0.005106592	0.001555799	-0.006151777	0.006329335	0.026542782	0.016833766	0.064187861	0.207600434	0.434314117	0.694480067	0.900992526	0.984917234
;0.004301979	0.004137253	0.003195694	-0.006291908	-0.005909247	0.014735868	0.012073196	0.055927517	0.191096634	0.414579258	0.679427614	0.89575322	0.984448086
;0.004771414	0.004340955	0.003714294	-0.003012829	-0.011538435	0.003608641	0.00720746	0.048144405	0.176603271	0.395903001	0.665524418	0.891389467	0.984637145
;0.004841478	0.004523584	0.003749334	0.000399375	-0.011482423	-0.003440471	0.003337306	0.041778957	0.163153655	0.377156638	0.651165724	0.88591201	0.983551802
;0.005149764	0.004263688	0.003426962	0.003187994	-0.008716839	-0.006894957	0.000623992	0.036852226	0.15069875	0.360057767	0.637304574	0.879923232	0.984287035
;0.004736381	0.004762406	0.003812407	0.004119869	-0.003381714	-0.006544604	7.01E-05	0.032641345	0.139532766	0.344459167	0.624578664	0.875930712	0.982676526
;0.004589245	0.004305834	0.00346901	0.00430204	-0.000119025	-0.00566872	-0.000140223	0.029658638	0.129368498	0.328706333	0.610633422	0.870915548	0.983565807
;0.004764407	0.004305834	0.003791383	0.003804572	0.003003634	-0.003447479	0.000946505	0.026310988	0.119939757	0.313696623	0.597718306	0.866348666	0.982767555
;0.004154843	0.004692165	0.003076556	0.003286086	0.003752792	-0.000553559	0.001444296	0.024037112	0.111344611	0.299724483	0.585756232	0.8616487	0.982809568
;0.004407077	0.004242616	0.003076556	0.002711546	0.00478901	0.000952962	0.001935077	0.022219415	0.103015656	0.286320202	0.572911192	0.856304328	0.982347422
;0.00440007	0.004453342	0.003504051	0.002424276	0.004249897	0.002886913	0.002601136	0.020359609	0.095821512	0.274290001	0.561292493	0.852830136	0.982361426
;0.003993694	0.004397148	0.003735318	0.002753586	0.003164668	0.00220022	0.002467924	0.017833081	0.089075689	0.26134141	0.549015073	0.847899024	0.982382433
;0.004603258	0.004537632	0.003567124	0.002368224	0.002744579	0.002480503	0.002573091	0.016583853	0.082848236	0.249886078	0.538881998	0.842848838	0.981626194
;0.004582239	0.004347979	0.003644213	0.002445296	0.00165935	0.00236839	0.002061277	0.014520521	0.076284543	0.239419241	0.527669743	0.839185526	0.982172366
;0.00428096	0.004045938	0.003223727	0.00323704	0.0018974	0.002284305	0.002089322	0.013720454	0.071142867	0.228763119	0.516338358	0.834443534	0.982011316
;0.00465931	0.003996769	0.003518067	0.002634474	0.002156455	0.001646661	0.001738765	0.011951884	0.066239361	0.218702897	0.505728762	0.829764581	0.981269081
;0.004477141	0.004425245	0.003567124	0.002522369	0.001582334	0.001716732	0.001612564	0.010625456	0.061630065	0.20926662	0.495308372	0.826087261	0.981381116
;0.003797513	0.00398272	0.003405937	0.003258059	0.00203743	0.001653669	0.002005188	0.009790298	0.057553151	0.200005608	0.485777955	0.82133126	0.981332101
;0.004182869	0.004151301	0.003518067	0.002676513	0.002205465	0.001380393	0.001780832	0.009137612	0.053616336	0.191999495	0.475588819	0.817044555	0.979847632
;0.00440007	0.004052962	0.003560115	0.002298158	0.002121448	0.001380393	0.001254995	0.008162091	0.050022766	0.183306342	0.465238506	0.811959346	0.980764922
;0.0045402	0.003743898	0.003223727	0.002466316	0.001904402	0.001212223	0.001949099	0.007460277	0.046226052	0.175412399	0.455448806	0.80751154	0.980974988
;0.004007707	0.004214519	0.002957419	0.001912796	0.002149454	0.001723739	0.001970133	0.006744428	0.043290953	0.168478909	0.446563093	0.803252853	0.97939949
;0.004624277	0.00403189	0.003153646	0.00239625	0.002660561	0.001688704	0.001907032	0.006526865	0.040481945	0.16099158	0.437348021	0.799596545	0.980295773
;0.004035733	0.004081059	0.002642054	0.002816645	0.002394505	0.001800817	0.001928066	0.006512829	0.037771006	0.154142217	0.428665531	0.794322217	0.980750917
;0.004582239	0.003842237	0.002824265	0.002452303	0.00165935	0.001709725	0.001332118	0.00564258	0.035172148	0.147285843	0.419667697	0.790462782	0.979385486]


m_expz = [1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0	1.0
;0.835090415	0.882475783	0.923031479	0.954746611	0.977702898	0.992034167	0.996575222	0.990510903	0.973824306	0.949910542	0.915602623	0.87454419	0.826324222
;0.469443701	0.605463486	0.732677863	0.842007134	0.925685726	0.978280111	0.994261563	0.972688883	0.914695471	0.827444599	0.713857052	0.584294135	0.448552818
;0.13368381	0.30614995	0.497883084	0.68741953	0.848953524	0.956447829	0.991125113	0.947295325	0.83160327	0.66601158	0.472449632	0.279964027	0.111422834
;-0.033981198	0.096097812	0.291916336	0.529440735	0.760871864	0.929543826	0.987404975	0.918249945	0.741403528	0.504930758	0.267457468	0.075002283	-0.049764575
;-0.053318487	0.004705766	0.153979239	0.393307677	0.673586781	0.90023743	0.985260093	0.88897192	0.653542533	0.372370849	0.136139084	-0.007728573	-0.059489411
;-0.015834872	-0.005100853	0.085288491	0.293668606	0.5933581	0.871373579	0.983298054	0.861562106	0.577171592	0.277538284	0.074425697	-0.010496807	-0.016546214
;0.012388832	0.012663943	0.062227473	0.226991621	0.525056924	0.841996937	0.982018158	0.834836126	0.511918474	0.217347816	0.057412704	0.011670145	0.013719715
;0.017004693	0.025095068	0.058929024	0.187535618	0.468394228	0.815071861	0.981005492	0.80936502	0.459440667	0.18090247	0.056464024	0.024619017	0.017077932
;0.009457231	0.025652422	0.057768588	0.161552912	0.421826205	0.78821703	0.979303652	0.786713854	0.41647938	0.157727907	0.055360744	0.024633068	0.008864293
;0.002790658	0.017722466	0.052100037	0.143998931	0.383823146	0.763315023	0.977925302	0.764323532	0.380548376	0.141026725	0.049900564	0.016412678	0.002861481
;0.001345999	0.010674399	0.042893915	0.127232944	0.35111415	0.739670408	0.976940766	0.743216282	0.349926958	0.12557232	0.040687828	0.009752053	0.00079058
;0.001952051	0.007196224	0.032717248	0.112387693	0.32302953	0.716524537	0.975421768	0.723300458	0.322367682	0.110279926	0.031215083	0.005480261	0.001728082
;0.002755423	0.005263121	0.025438152	0.097612799	0.297503824	0.694537715	0.975161569	0.704131917	0.297470221	0.096135694	0.023962952	0.004932234	0.002826499
;0.002825894	0.005728759	0.020472895	0.084758642	0.274981143	0.674538839	0.973410502	0.686027903	0.276309136	0.083421383	0.018615208	0.005157066	0.003435176
;0.003298051	0.005749924	0.01756829	0.072706549	0.254446379	0.654406496	0.972411902	0.669016616	0.255829307	0.072376485	0.016359458	0.005143014	0.002714559
;0.003002072	0.005277231	0.015479506	0.064137111	0.235391979	0.635587744	0.971012454	0.652082878	0.237245758	0.063099615	0.014258308	0.004461494	0.002679577
;0.00239602	0.004458837	0.013742369	0.05617274	0.217832042	0.617576813	0.969936497	0.63514209	0.220094954	0.055851401	0.012944211	0.004517702	0.003022395
;0.002677904	0.004416506	0.012483473	0.049742143	0.201787716	0.59939027	0.968607374	0.620647599	0.204250478	0.049258273	0.011222532	0.003484884	0.002833495
;0.002670857	0.003407624	0.010704138	0.04457093	0.186582262	0.583128451	0.968079944	0.605285977	0.190203956	0.043954186	0.010505752	0.003330312	0.00274954
;0.00198024	0.002829104	0.009508538	0.039653001	0.173597355	0.567182736	0.966392169	0.591179228	0.17653669	0.039199527	0.008594337	0.002733104	0.002595622
;0.002290313	0.003598112	0.008228542	0.03524164	0.161387877	0.551735765	0.965006786	0.577298075	0.164807844	0.035142217	0.007540249	0.003112507	0.00256064
;0.002572198	0.003026647	0.007222832	0.031808236	0.150278097	0.536274744	0.963776117	0.563339373	0.153086021	0.031211699	0.006212097	0.002768234	0.002826499
;0.002494679	0.002786773	0.00616789	0.028220047	0.139393897	0.521558325	0.962883002	0.550783591	0.143239409	0.027816519	0.005193144	0.003231949	0.002609614
;0.002304407	0.002977261	0.005872507	0.025511317	0.130405972	0.507523286	0.961610138	0.537579223	0.133477076	0.024984856	0.005453153	0.002613663	0.002658588
;0.001536272	0.002102426	0.005654486	0.022485981	0.121636578	0.493909721	0.960252885	0.524981142	0.124403023	0.022181367	0.004926108	0.00291578	0.00274954
;0.002424208	0.002934931	0.00485273	0.020677816	0.113395885	0.480717627	0.958951891	0.512601606	0.115637993	0.019596241	0.004082837	0.002627715	0.002602618
;0.002156418	0.002377576	0.004451852	0.018574152	0.105775535	0.468087498	0.958965956	0.500504064	0.108207383	0.01810997	0.00415311	0.002754182	0.002350752
;0.002233936	0.002730332	0.004346358	0.016787094	0.098655688	0.456033381	0.957109403	0.489069208	0.101170075	0.015989744	0.003836883	0.002571507	0.002287785
;0.002022523	0.002497513	0.004156469	0.014908572	0.091923557	0.443986288	0.955667761	0.477704851	0.095361838	0.014933153	0.003373084	0.002690948	0.002301778
;0.002684952	0.002017765	0.003607899	0.013480332	0.085924558	0.431784656	0.955463822	0.467158276	0.088141926	0.013235563	0.003612011	0.002733104	0.002420715
;0.001620837	0.002624505	0.003959547	0.012734551	0.08078558	0.420966858	0.953776046	0.4566681	0.082811271	0.011925391	0.003309839	0.002318572	0.002518663
;0.002311454	0.002963151	0.003129659	0.011264098	0.075639553	0.409980472	0.95299545	0.446128575	0.077571918	0.010579998	0.003344975	0.002480169	0.002091889
;0.002057758	0.00229997	0.00341801	0.010300212	0.070535821	0.399970497	0.952074206	0.436371583	0.072142937	0.009854472	0.003084967	0.002353702	0.002329763
;0.002269172	0.002285859	0.003312516	0.009561467	0.065805706	0.389124601	0.951082638	0.426107003	0.068139679	0.009227562	0.002796849	0.002508273	0.002469689
;0.002092994	0.002031875	0.003192956	0.009090078	0.061815772	0.379121651	0.949971519	0.41686465	0.063476233	0.008304805	0.003063885	0.002156974	0.00250467
;0.00166312	0.002222363	0.002679551	0.008302083	0.057896332	0.369483977	0.948234516	0.407065359	0.059774975	0.00793852	0.00284604	0.002459091	0.002336759
;0.002008428	0.002201198	0.002883506	0.007556303	0.054625433	0.360422316	0.947960253	0.398224848	0.055603158	0.007375005	0.002670358	0.002318572	0.002952432
;0.001360094	0.00287849	0.002405266	0.0069442	0.05117125	0.351374703	0.947271078	0.389652231	0.052519946	0.006501557	0.002466568	0.002550429	0.002532655
;0.002022523	0.002060096	0.002693617	0.006824594	0.047639524	0.342298993	0.945963052	0.380431028	0.049528037	0.005656284	0.002543868	0.002093741	0.002021926
;0.001501036	0.003111309	0.002672518	0.006135099	0.04496782	0.333778221	0.944922257	0.37237305	0.04660636	0.005825338	0.003028749	0.002381806	0.002630603]


Jval_data = [1454.657986	1435.517842	1464.272752	1467.005513	1466.262793	1486.197772	1473.283053
;1454.666266	1435.325264	1439.688351	1441.991034	1466.836405	1460.383482	1499.246627
;1454.811504	1435.023863	1464.426201	1467.432687	1466.399301	1435.452848	1472.851399
;1454.559258	1435.281123	1464.513636	1466.932131	1441.302904	1460.438878	1472.532143
;1454.622704	1435.083899	1464.434728	1442.091087	1492.340904	1485.859003	1471.922705
;1454.787735	1435.135894	1464.717075	1442.205916	1466.697485	1486.509047	1472.153968
;1454.631917	1435.232669	1464.475392	1441.663912	1466.371571	1486.470332	1472.605162
;1454.830247	1435.019847	1464.528648	1493.08899	1465.878169	1485.874661	1472.427265
;1454.369551	1435.135102	1464.232431	1467.119871	1465.932357	1434.921954	1472.677008
;1454.539867	1435.383543	1464.250047	1442.12952	1465.944942	1460.042952	1447.287322]


t_exp_arr = mean(Jval_data)*0.001 * 2π * [0, 0.12, 0.24, 0.36, 0.48, 0.6, 0.72, 0.84, 0.96, 1.08, 1.2, 1.32, 1.44, 1.56, 1.68, 1.8, 1.92, 2.04, 2.16, 2.28, 2.4, 2.52, 2.64, 2.76, 2.88, 3, 3.12, 3.24, 3.36, 3.48, 3.6, 3.72, 3.84, 3.96, 4.08, 4.2, 4.32, 4.44, 4.56, 4.68, 4.8] 


xi_arr_all_x = [[-0.4, 0.2, 0.2], [-0.35, 0.15, 0.2], [-0.3, 0.1, 0.2], [-0.25, 0.05, 0.2], [-0.2, 0.0, 0.2], [-0.15, -0.05, 0.2], [-0.1, -0.1, 0.2], [-0.05, -0.15, 0.2], [0.0, -0.2, 0.2], [0.05, -0.25, 0.2], [0.1, -0.3, 0.2], [0.15, -0.35, 0.2], [0.2, -0.4, 0.2]]
xi_arr_all_y = [[0.2, 0.2, -0.4], [0.15, 0.2, -0.35], [0.1, 0.2, -0.3], [0.05, 0.2, -0.25], [0.0, 0.2, -0.2], [-0.05, 0.2, -0.15], [-0.1, 0.2, -0.1], [-0.15, 0.2, -0.05], [-0.2, 0.2, 0.0], [-0.25, 0.2, 0.05], [-0.3, 0.2, 0.1], [-0.35, 0.2, 0.15], [-0.4, 0.2, 0.2]]
xi_arr_all_z = [[0.2, -0.4, 0.2], [0.2, -0.35, 0.15], [0.2, -0.3, 0.1], [0.2, -0.25, 0.05], [0.2, -0.2, 0.0], [0.2, -0.15, -0.05], [0.2, -0.1, -0.1], [0.2, -0.05, -0.15], [0.2, 0.0, -0.2], [0.2, 0.05, -0.25], [0.2, 0.1, -0.3], [0.2, 0.15, -0.35], [0.2, 0.2, -0.4]]

xi_x_len = length(xi_arr_all_x)

omega_list_xyz = zeros(xi_x_len, 3)

total_dirname = "fig_expdata"
# fitstep_span = (1, 12*25)

if !isdir(total_dirname)
     mkdir(total_dirname)
end

# Get Error bar

direct_string = ["x", "y", "z"]

# The second dim data: mean, delta_-, delta_+
omega_fit_mean_error_xyz = zeros(xi_x_len, 3, length(direct_string))
decay_fit_mean_error_xyz = zeros(xi_x_len, 3, length(direct_string))
for a in 1:3

    Sxyz_t = m_expx
    xi_arr_all = xi_arr_all_x
    if a == 1
        Sxyz_t = m_expx
        xi_arr_all = xi_arr_all_x
    elseif a == 2
        Sxyz_t = m_expy
        xi_arr_all = xi_arr_all_y
    elseif a == 3
        Sxyz_t = m_expz
        xi_arr_all = xi_arr_all_z
    end

    fit_end_arr = collect(15:41)
    omega_diff_fit = zeros(xi_x_len, length(fit_end_arr))
    decay_diff_fit = zeros(xi_x_len, length(fit_end_arr))
    for (iind, fit_end) in enumerate(fit_end_arr)
        fitstep_span = (1, fit_end)

        coef_fit_arr = zeros(xi_x_len, 5)
        for ll in 1:xi_x_len
            @. model(x, p) = p[1]*exp(-x*p[2])*(cos(p[3]*x+p[4]) ) + p[5]
            xdata = (t_exp_arr)[fitstep_span[1]:fitstep_span[2]]
            ydata = (Sxyz_t[:,ll])[fitstep_span[1]:fitstep_span[2]]
            p0 = [0.516627,  0.240574,    0.01,    -0.728552, 0.0]
            lb = [0.2,0.0,0.0,-π, -0.01]
            ub = [2.0,4.0,2.0,π, 0.01]
            # p0 = [0.516627,  0.240574,    0.01,    0.0, 0.0]
            # lb = [0.2,0.0,0.0,0.0, 0.0]
            # ub = [2.0,4.0,2.0,0.0, 0.1]
            fitfunc = curve_fit(model, xdata, ydata, p0, lower=lb, upper=ub)
            # fitfunc = curve_fit(model, xdata, ydata, p0)

            coef_fit_arr[ll,:] = coef(fitfunc)
        end
        omega_diff_fit[:,iind] = coef_fit_arr[:,3]
        decay_diff_fit[:,iind] = coef_fit_arr[:,2]
    end

    println("omega_diff_fit")
    display(omega_diff_fit)
    for ll in 1:xi_x_len
        
        omega_fit_mean_error_xyz[ll,1,a] = mean(omega_diff_fit[ll,:])
        omega_fit_mean_error_xyz[ll,2,a] = minimum(omega_diff_fit[ll,:]) - omega_fit_mean_error_xyz[ll,1,a]
        omega_fit_mean_error_xyz[ll,3,a] = maximum(omega_diff_fit[ll,:]) - omega_fit_mean_error_xyz[ll,1,a]


        decay_fit_mean_error_xyz[ll,1,a] = mean(decay_diff_fit[ll,:])
        decay_fit_mean_error_xyz[ll,2,a] = minimum(decay_diff_fit[ll,:]) - decay_fit_mean_error_xyz[ll,1,a]
        decay_fit_mean_error_xyz[ll,3,a] = maximum(decay_diff_fit[ll,:]) - decay_fit_mean_error_xyz[ll,1,a]
    end

end

# Get one curve value
c0val_arr = zeros(3)
for a in 1:3
    direct_string = ["x", "y", "z"]

    Sxyz_t = m_expx
    xi_arr_all = xi_arr_all_x
    if a == 1
        Sxyz_t = m_expx
        xi_arr_all = xi_arr_all_x
    elseif a == 2
        Sxyz_t = m_expy
        xi_arr_all = xi_arr_all_y
    elseif a == 3
        Sxyz_t = m_expz
        xi_arr_all = xi_arr_all_z
    end
    
    coef_fit_arr = zeros(xi_x_len, 5)
    fitstep_span = (1, length(t_exp_arr))
    for ll in 1:xi_x_len
        @. model(x, p) = p[1]*exp(-x*p[2])*cos(p[3]*x+p[4]) + p[5]
        # @. model(x, p) = p[1]*1.0/cosh(x*p[2])*cos(p[3]*x+p[4]) + p[5]
        xdata = (t_exp_arr)[fitstep_span[1]:fitstep_span[2]]
        ydata = (Sxyz_t[:,ll])[fitstep_span[1]:fitstep_span[2]]
        # p0 = [0.516627,  1.240574,    0.01,    -0.728552, 0.0]
        # lb = [0.2,0.0,0.0,-π, -0.01]
        # ub = [2.0,4.0,2.0,π, 0.01]
        p0 = [0.516627,  1.240574,    0.01,    0.0, 0.0]
        lb = [0.2,0.0,0.0,0.0, -0.01]
        ub = [2.0,4.0,2.0,0.0, 0.01]
        fitfunc = curve_fit(model, xdata, ydata, p0, lower=lb, upper=ub)
        # fitfunc = curve_fit(model, xdata, ydata, p0)

        coef_fit_arr[ll,:] = coef(fitfunc)
    end
    display(coef_fit_arr)

    fit_all_xi = zeros(xi_x_len, (fitstep_span[2]-fitstep_span[1]+1))
    for ll in 1:xi_x_len
        @. modelfit(x, p) = p[1]*exp(-x*p[2])*cos(p[3]*x+p[4]) + p[5]
        # @. modelfit(x, p) = p[1]*1.0/cosh(x*p[2])*cos(p[3]*x+p[4]) + p[5]
        pval = coef_fit_arr[ll,:]
        xdata = (t_exp_arr)[fitstep_span[1]:fitstep_span[2]]
        for (i,x) in enumerate(xdata)
            tempa = modelfit(x, pval)
            fit_all_xi[ll,i] = tempa
        end
    end


    @. model_freq(x, p) = p[1]*x
    Sxfreqtheory = [A_polynomial(xi) for xi in xi_arr_all]
    xdata = Sxfreqtheory
    ydata = coef_fit_arr[:,3]
    p0 = [1.0]
    fitsqrtAfunc = curve_fit(model_freq, xdata, ydata, p0)

    c0val = coef(fitsqrtAfunc)[1]
    c0val_arr[a] = c0val
    
    fontsize = 11
    plot(t_exp_arr, Sxyz_t[:,:], title = L"$ \mathrm{Exp}, \rho_%$(direct_string[a])$", xlabel=L"$tJ$",ylabel=L"$m(t)/m(0)$", legend = false, titlefontsize=fontsize, legendfont=font(fontsize))
    figplot = plot!(((t_exp_arr)[fitstep_span[1]:fitstep_span[2]]), transpose(fit_all_xi), title = L"$ \mathrm{Exp}, \rho_%$(direct_string[a])$", xlabel=L"$tJ$",ylabel=L"$m(t)/m(0)$", legend = false, titlefontsize=fontsize, legendfont=font(fontsize), linestyle=:dash)



    fileprefix = "exp_rho$(direct_string[a])"
    savefig(figplot, "$(total_dirname)/exp_$(fileprefix)_xiall.pdf")
    savefig(figplot, "$(total_dirname)/exp_$(fileprefix)_xiall.png")

    omega_list_xyz[:,a] = coef_fit_arr[:,3]

end

JLD2.save("$(total_dirname)/exp_xiall.jld2", "omega_list_xyz", omega_list_xyz)
println(omega_list_xyz)
println("c0val_arr")
println(c0val_arr)


for a in 1:3
    writedlm("fig_expdata/exp_omega_meanerrorbar_rho$(direct_string[a]).csv",  omega_fit_mean_error_xyz[:,:,a], ',')
    writedlm("fig_expdata/exp_decay_meanerrorbar_rho$(direct_string[a]).csv",  decay_fit_mean_error_xyz[:,:,a], ',')
end